<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Diagrams/TwoD/Path.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE FlexibleContexts
<a name="line-2"></a>           , FlexibleInstances
<a name="line-3"></a>           , DeriveDataTypeable
<a name="line-4"></a>           , GeneralizedNewtypeDeriving
<a name="line-5"></a>           , TypeFamilies
<a name="line-6"></a>           , ViewPatterns
<a name="line-7"></a>  #-}</span>
<a name="line-8"></a><span class='hs-comment'>{-# OPTIONS_GHC -fno-warn-orphans #-}</span>
<a name="line-9"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-10"></a><span class='hs-comment'>-- |</span>
<a name="line-11"></a><span class='hs-comment'>-- Module      :  Diagrams.TwoD.Path</span>
<a name="line-12"></a><span class='hs-comment'>-- Copyright   :  (c) 2011 diagrams-lib team (see LICENSE)</span>
<a name="line-13"></a><span class='hs-comment'>-- License     :  BSD-style (see LICENSE)</span>
<a name="line-14"></a><span class='hs-comment'>-- Maintainer  :  diagrams-discuss@googlegroups.com</span>
<a name="line-15"></a><span class='hs-comment'>--</span>
<a name="line-16"></a><span class='hs-comment'>-- Paths in two dimensions are special since we may stroke them to</span>
<a name="line-17"></a><span class='hs-comment'>-- create a 2D diagram, and (eventually) perform operations such as</span>
<a name="line-18"></a><span class='hs-comment'>-- intersection and union.</span>
<a name="line-19"></a><span class='hs-comment'>--</span>
<a name="line-20"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-21"></a>
<a name="line-22"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Diagrams</span><span class='hs-varop'>.</span><span class='hs-conid'>TwoD</span><span class='hs-varop'>.</span><span class='hs-conid'>Path</span>
<a name="line-23"></a>       <span class='hs-layout'>(</span> <span class='hs-comment'>-- * Constructing path-based diagrams</span>
<a name="line-24"></a>
<a name="line-25"></a>         <span class='hs-varid'>stroke</span><span class='hs-layout'>,</span> <span class='hs-varid'>stroke'</span><span class='hs-layout'>,</span> <span class='hs-varid'>strokeT</span><span class='hs-layout'>,</span> <span class='hs-varid'>strokeT'</span>
<a name="line-26"></a>
<a name="line-27"></a>         <span class='hs-comment'>-- ** Stroke options</span>
<a name="line-28"></a>
<a name="line-29"></a>       <span class='hs-layout'>,</span> <span class='hs-conid'>FillRule</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-30"></a>       <span class='hs-layout'>,</span> <span class='hs-conid'>FillRuleA</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>getFillRule</span><span class='hs-layout'>,</span> <span class='hs-varid'>fillRule</span>
<a name="line-31"></a>       <span class='hs-layout'>,</span> <span class='hs-conid'>StrokeOpts</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-32"></a>
<a name="line-33"></a>         <span class='hs-comment'>-- ** Inside/outside testing</span>
<a name="line-34"></a>
<a name="line-35"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>isInsideWinding</span><span class='hs-layout'>,</span> <span class='hs-varid'>isInsideEvenOdd</span>
<a name="line-36"></a>
<a name="line-37"></a>         <span class='hs-comment'>-- * Clipping</span>
<a name="line-38"></a>
<a name="line-39"></a>       <span class='hs-layout'>,</span> <span class='hs-conid'>Clip</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>clipBy</span>
<a name="line-40"></a>       <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-41"></a>
<a name="line-42"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Graphics</span><span class='hs-varop'>.</span><span class='hs-conid'>Rendering</span><span class='hs-varop'>.</span><span class='hs-conid'>Diagrams</span>
<a name="line-43"></a>
<a name="line-44"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Diagrams</span><span class='hs-varop'>.</span><span class='hs-conid'>Util</span> <span class='hs-layout'>(</span><span class='hs-varid'>tau</span><span class='hs-layout'>)</span>
<a name="line-45"></a>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Diagrams</span><span class='hs-varop'>.</span><span class='hs-conid'>Segment</span>
<a name="line-47"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Diagrams</span><span class='hs-varop'>.</span><span class='hs-conid'>Path</span>
<a name="line-48"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Diagrams</span><span class='hs-varop'>.</span><span class='hs-conid'>TwoD</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span>
<a name="line-49"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Diagrams</span><span class='hs-varop'>.</span><span class='hs-conid'>Solve</span>
<a name="line-50"></a>
<a name="line-51"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>AffineSpace</span>
<a name="line-52"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>VectorSpace</span>
<a name="line-53"></a>
<a name="line-54"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Semigroup</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>&lt;&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-55"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Applicative</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftA2</span><span class='hs-layout'>)</span>
<a name="line-56"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Foldable</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>F</span>
<a name="line-57"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Default</span>
<a name="line-58"></a>
<a name="line-59"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Typeable</span>
<a name="line-60"></a>
<a name="line-61"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-62"></a><span class='hs-comment'>--  Constructing path-based diagrams  ----------------------</span>
<a name="line-63"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-64"></a>
<a name="line-65"></a><a name="stroke"></a><span class='hs-comment'>-- | Convert a path into a diagram.  The resulting diagram has the</span>
<a name="line-66"></a><span class='hs-comment'>--   names 0, 1, ... assigned to each of the path's vertices.</span>
<a name="line-67"></a><span class='hs-comment'>--</span>
<a name="line-68"></a><span class='hs-comment'>--   See also 'stroke'', which takes an extra options record allowing</span>
<a name="line-69"></a><span class='hs-comment'>--   its behavior to be customized.</span>
<a name="line-70"></a><span class='hs-comment'>--</span>
<a name="line-71"></a><span class='hs-comment'>--   Note that a bug in GHC 7.0.1 causes a context stack overflow when</span>
<a name="line-72"></a><span class='hs-comment'>--   inferring the type of @stroke@.  The solution is to give a type</span>
<a name="line-73"></a><span class='hs-comment'>--   signature to expressions involving @stroke@, or (recommended)</span>
<a name="line-74"></a><span class='hs-comment'>--   upgrade GHC (the bug is fixed in 7.0.2 onwards).</span>
<a name="line-75"></a><span class='hs-definition'>stroke</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Renderable</span> <span class='hs-layout'>(</span><span class='hs-conid'>Path</span> <span class='hs-conid'>R2</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span>
<a name="line-76"></a>       <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Path</span> <span class='hs-conid'>R2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Diagram</span> <span class='hs-varid'>b</span> <span class='hs-conid'>R2</span>
<a name="line-77"></a><span class='hs-definition'>stroke</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stroke'</span> <span class='hs-layout'>(</span><span class='hs-varid'>def</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>StrokeOpts</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-78"></a>
<a name="line-79"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Renderable</span> <span class='hs-layout'>(</span><span class='hs-conid'>Path</span> <span class='hs-conid'>R2</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>PathLike</span> <span class='hs-layout'>(</span><span class='hs-conid'>QDiagram</span> <span class='hs-varid'>b</span> <span class='hs-conid'>R2</span> <span class='hs-conid'>Any</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-80"></a>  <span class='hs-varid'>pathLike</span> <span class='hs-varid'>st</span> <span class='hs-varid'>cl</span> <span class='hs-varid'>segs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stroke</span> <span class='hs-varop'>$</span> <span class='hs-varid'>pathLike</span> <span class='hs-varid'>st</span> <span class='hs-varid'>cl</span> <span class='hs-varid'>segs</span>
<a name="line-81"></a>
<a name="line-82"></a><a name="stroke'"></a><span class='hs-comment'>-- | A variant of 'stroke' that takes an extra record of options to</span>
<a name="line-83"></a><span class='hs-comment'>--   customize its behavior.  In particular:</span>
<a name="line-84"></a><span class='hs-comment'>--</span>
<a name="line-85"></a><span class='hs-comment'>--     * Names can be assigned to the path's vertices</span>
<a name="line-86"></a><span class='hs-comment'>--</span>
<a name="line-87"></a><span class='hs-comment'>--   'StrokeOpts' is an instance of 'Default', so @stroke' 'with' {</span>
<a name="line-88"></a><span class='hs-comment'>--   ... }@ syntax may be used.</span>
<a name="line-89"></a><span class='hs-definition'>stroke'</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Renderable</span> <span class='hs-layout'>(</span><span class='hs-conid'>Path</span> <span class='hs-conid'>R2</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>IsName</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>StrokeOpts</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Path</span> <span class='hs-conid'>R2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Diagram</span> <span class='hs-varid'>b</span> <span class='hs-conid'>R2</span>
<a name="line-90"></a><span class='hs-definition'>stroke'</span> <span class='hs-varid'>opts</span> <span class='hs-varid'>p</span>
<a name="line-91"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkQD</span> <span class='hs-layout'>(</span><span class='hs-conid'>Prim</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-92"></a>         <span class='hs-layout'>(</span><span class='hs-varid'>getEnvelope</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-93"></a>         <span class='hs-layout'>(</span><span class='hs-varid'>fromNames</span> <span class='hs-varop'>.</span> <span class='hs-varid'>concat</span> <span class='hs-varop'>$</span>
<a name="line-94"></a>           <span class='hs-varid'>zipWith</span> <span class='hs-varid'>zip</span> <span class='hs-layout'>(</span><span class='hs-varid'>vertexNames</span> <span class='hs-varid'>opts</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>pathVertices</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-95"></a>         <span class='hs-layout'>(</span><span class='hs-conid'>Query</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Any</span> <span class='hs-varop'>.</span> <span class='hs-varid'>flip</span> <span class='hs-layout'>(</span><span class='hs-varid'>runFillRule</span> <span class='hs-layout'>(</span><span class='hs-varid'>queryFillRule</span> <span class='hs-varid'>opts</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-96"></a>
<a name="line-97"></a><a name="StrokeOpts"></a><span class='hs-comment'>-- | A record of options that control how a path is stroked.</span>
<a name="line-98"></a><a name="StrokeOpts"></a><span class='hs-comment'>--   @StrokeOpts@ is an instance of 'Default', so a @StrokeOpts@</span>
<a name="line-99"></a><a name="StrokeOpts"></a><span class='hs-comment'>--   records can be created using @'with' { ... }@ notation.</span>
<a name="line-100"></a><a name="StrokeOpts"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>StrokeOpts</span> <span class='hs-varid'>a</span>
<a name="line-101"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StrokeOpts</span>
<a name="line-102"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>vertexNames</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- ^ Atomic names that should be assigned</span>
<a name="line-103"></a>                            <span class='hs-comment'>--   to the vertices of the path so that</span>
<a name="line-104"></a>                            <span class='hs-comment'>--   they can be referenced later.  If</span>
<a name="line-105"></a>                            <span class='hs-comment'>--   there are not enough names, the extra</span>
<a name="line-106"></a>                            <span class='hs-comment'>--   vertices are not assigned names; if</span>
<a name="line-107"></a>                            <span class='hs-comment'>--   there are too many, the extra names</span>
<a name="line-108"></a>                            <span class='hs-comment'>--   are ignored.  Note that this is a</span>
<a name="line-109"></a>                            <span class='hs-comment'>--   /list of lists/ of names, since paths</span>
<a name="line-110"></a>                            <span class='hs-comment'>--   can consist of multiple trails.  The</span>
<a name="line-111"></a>                            <span class='hs-comment'>--   first list of names are assigned to</span>
<a name="line-112"></a>                            <span class='hs-comment'>--   the vertices of the first trail, the</span>
<a name="line-113"></a>                            <span class='hs-comment'>--   second list to the second trail, and</span>
<a name="line-114"></a>                            <span class='hs-comment'>--   so on.</span>
<a name="line-115"></a>                            <span class='hs-comment'>--</span>
<a name="line-116"></a>                            <span class='hs-comment'>--   The default value is the empty list.</span>
<a name="line-117"></a>
<a name="line-118"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>queryFillRule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FillRule</span>
<a name="line-119"></a>                            <span class='hs-comment'>-- ^ The fill rule used for determining</span>
<a name="line-120"></a>                            <span class='hs-comment'>--   which points are inside the path.</span>
<a name="line-121"></a>                            <span class='hs-comment'>--   The default is 'Winding'.  NOTE: for</span>
<a name="line-122"></a>                            <span class='hs-comment'>--   now, this only affects the resulting</span>
<a name="line-123"></a>                            <span class='hs-comment'>--   diagram's 'Query', /not/ how it will</span>
<a name="line-124"></a>                            <span class='hs-comment'>--   be drawn!  To set the fill rule</span>
<a name="line-125"></a>                            <span class='hs-comment'>--   determining how it is to be drawn,</span>
<a name="line-126"></a>                            <span class='hs-comment'>--   use the 'fillRule' function.</span>
<a name="line-127"></a>    <span class='hs-layout'>}</span>
<a name="line-128"></a>
<a name="line-129"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Default</span> <span class='hs-layout'>(</span><span class='hs-conid'>StrokeOpts</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-130"></a>  <span class='hs-varid'>def</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StrokeOpts</span>
<a name="line-131"></a>        <span class='hs-layout'>{</span> <span class='hs-varid'>vertexNames</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-132"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>queryFillRule</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Winding</span>
<a name="line-133"></a>        <span class='hs-layout'>}</span>
<a name="line-134"></a>
<a name="line-135"></a><a name="strokeT"></a><span class='hs-comment'>-- | A composition of 'stroke' and 'pathFromTrail' for conveniently</span>
<a name="line-136"></a><span class='hs-comment'>--   converting a trail directly into a diagram.</span>
<a name="line-137"></a><span class='hs-comment'>--</span>
<a name="line-138"></a><span class='hs-comment'>--   Note that a bug in GHC 7.0.1 causes a context stack overflow when</span>
<a name="line-139"></a><span class='hs-comment'>--   inferring the type of 'stroke' and hence of @strokeT@ as well.</span>
<a name="line-140"></a><span class='hs-comment'>--   The solution is to give a type signature to expressions involving</span>
<a name="line-141"></a><span class='hs-comment'>--   @strokeT@, or (recommended) upgrade GHC (the bug is fixed in 7.0.2</span>
<a name="line-142"></a><span class='hs-comment'>--   onwards).</span>
<a name="line-143"></a><span class='hs-definition'>strokeT</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Renderable</span> <span class='hs-layout'>(</span><span class='hs-conid'>Path</span> <span class='hs-conid'>R2</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-144"></a>        <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Trail</span> <span class='hs-conid'>R2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Diagram</span> <span class='hs-varid'>b</span> <span class='hs-conid'>R2</span>
<a name="line-145"></a><span class='hs-definition'>strokeT</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stroke</span> <span class='hs-varop'>.</span> <span class='hs-varid'>pathFromTrail</span>
<a name="line-146"></a>
<a name="line-147"></a><a name="strokeT'"></a><span class='hs-comment'>-- | A composition of 'stroke'' and 'pathFromTrail' for conveniently</span>
<a name="line-148"></a><span class='hs-comment'>--   converting a trail directly into a diagram.</span>
<a name="line-149"></a><span class='hs-definition'>strokeT'</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Renderable</span> <span class='hs-layout'>(</span><span class='hs-conid'>Path</span> <span class='hs-conid'>R2</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>IsName</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-150"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>StrokeOpts</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Trail</span> <span class='hs-conid'>R2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Diagram</span> <span class='hs-varid'>b</span> <span class='hs-conid'>R2</span>
<a name="line-151"></a><span class='hs-definition'>strokeT'</span> <span class='hs-varid'>opts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stroke'</span> <span class='hs-varid'>opts</span> <span class='hs-varop'>.</span> <span class='hs-varid'>pathFromTrail</span>
<a name="line-152"></a>
<a name="line-153"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-154"></a><span class='hs-comment'>--  Inside/outside testing</span>
<a name="line-155"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-156"></a>
<a name="line-157"></a><a name="FillRule"></a><span class='hs-comment'>-- | Enumeration of algorithms or \"rules\" for determining which</span>
<a name="line-158"></a><a name="FillRule"></a><span class='hs-comment'>--   points lie in the interior of a (possibly self-intersecting)</span>
<a name="line-159"></a><a name="FillRule"></a><span class='hs-comment'>--   closed path.</span>
<a name="line-160"></a><a name="FillRule"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>FillRule</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Winding</span>  <span class='hs-comment'>-- ^ Interior points are those with a nonzero</span>
<a name="line-161"></a>                         <span class='hs-comment'>--   /winding/ /number/.  See</span>
<a name="line-162"></a>                         <span class='hs-comment'>--   &lt;<a href="http://en.wikipedia.org/wiki/Nonzero-rule">http://en.wikipedia.org/wiki/Nonzero-rule</a>&gt;.</span>
<a name="line-163"></a>              <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EvenOdd</span>  <span class='hs-comment'>-- ^ Interior points are those where a ray</span>
<a name="line-164"></a>                         <span class='hs-comment'>--   extended infinitely in a particular</span>
<a name="line-165"></a>                         <span class='hs-comment'>--   direction crosses the path an odd number</span>
<a name="line-166"></a>                         <span class='hs-comment'>--   of times. See</span>
<a name="line-167"></a>                         <span class='hs-comment'>--   &lt;<a href="http://en.wikipedia.org/wiki/Even-odd_rule">http://en.wikipedia.org/wiki/Even-odd_rule</a>&gt;.</span>
<a name="line-168"></a>
<a name="line-169"></a><a name="runFillRule"></a><span class='hs-definition'>runFillRule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FillRule</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>P2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Path</span> <span class='hs-conid'>R2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-170"></a><span class='hs-definition'>runFillRule</span> <span class='hs-conid'>Winding</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isInsideWinding</span>
<a name="line-171"></a><span class='hs-definition'>runFillRule</span> <span class='hs-conid'>EvenOdd</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isInsideEvenOdd</span>
<a name="line-172"></a>
<a name="line-173"></a><a name="FillRuleA"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>FillRuleA</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FillRuleA</span> <span class='hs-layout'>(</span><span class='hs-conid'>Last</span> <span class='hs-conid'>FillRule</span><span class='hs-layout'>)</span>
<a name="line-174"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Typeable</span><span class='hs-layout'>,</span> <span class='hs-conid'>Semigroup</span><span class='hs-layout'>)</span>
<a name="line-175"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>AttributeClass</span> <span class='hs-conid'>FillRuleA</span>
<a name="line-176"></a>
<a name="line-177"></a><a name="getFillRule"></a><span class='hs-comment'>-- | Extract the fill rule from a 'FillRuleA' attribute.</span>
<a name="line-178"></a><span class='hs-definition'>getFillRule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FillRuleA</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FillRule</span>
<a name="line-179"></a><span class='hs-definition'>getFillRule</span> <span class='hs-layout'>(</span><span class='hs-conid'>FillRuleA</span> <span class='hs-layout'>(</span><span class='hs-conid'>Last</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>r</span>
<a name="line-180"></a>
<a name="line-181"></a><a name="fillRule"></a><span class='hs-comment'>-- | Specify the fill rule that should be used for determining which</span>
<a name="line-182"></a><span class='hs-comment'>--   points are inside a path.</span>
<a name="line-183"></a><span class='hs-definition'>fillRule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HasStyle</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>FillRule</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-184"></a><span class='hs-definition'>fillRule</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>applyAttr</span> <span class='hs-varop'>.</span> <span class='hs-conid'>FillRuleA</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Last</span>
<a name="line-185"></a>
<a name="line-186"></a><a name="cross"></a><span class='hs-definition'>cross</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>R2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>R2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Double</span>
<a name="line-187"></a><span class='hs-definition'>cross</span> <span class='hs-layout'>(</span><span class='hs-varid'>unr2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>unr2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>x'</span><span class='hs-layout'>,</span><span class='hs-varid'>y'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span> <span class='hs-varop'>*</span> <span class='hs-varid'>y'</span> <span class='hs-comment'>-</span> <span class='hs-varid'>y</span> <span class='hs-varop'>*</span> <span class='hs-varid'>x'</span>
<a name="line-188"></a>
<a name="line-189"></a><span class='hs-comment'>-- XXX link to more info on this</span>
<a name="line-190"></a>
<a name="line-191"></a><a name="isInsideWinding"></a><span class='hs-comment'>-- | Test whether the given point is inside the given (closed) path,</span>
<a name="line-192"></a><span class='hs-comment'>--   by testing whether the point's /winding number/ is nonzero. Note</span>
<a name="line-193"></a><span class='hs-comment'>--   that @False@ is /always/ returned for /open/ paths, regardless of</span>
<a name="line-194"></a><span class='hs-comment'>--   the winding number.</span>
<a name="line-195"></a><span class='hs-definition'>isInsideWinding</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>P2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Path</span> <span class='hs-conid'>R2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-196"></a><span class='hs-definition'>isInsideWinding</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>/=</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>crossings</span> <span class='hs-varid'>p</span>
<a name="line-197"></a>
<a name="line-198"></a><a name="isInsideEvenOdd"></a><span class='hs-comment'>-- | Test whether the given point is inside the given (closed) path,</span>
<a name="line-199"></a><span class='hs-comment'>--   by testing whether a ray extending from the point in the positive</span>
<a name="line-200"></a><span class='hs-comment'>--   x direction crosses the path an even (outside) or odd (inside)</span>
<a name="line-201"></a><span class='hs-comment'>--   number of times.  Note that @False@ is /always/ returned for</span>
<a name="line-202"></a><span class='hs-comment'>--   /open/ paths, regardless of the number of crossings.</span>
<a name="line-203"></a><span class='hs-definition'>isInsideEvenOdd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>P2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Path</span> <span class='hs-conid'>R2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-204"></a><span class='hs-definition'>isInsideEvenOdd</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>odd</span> <span class='hs-varop'>.</span> <span class='hs-varid'>crossings</span> <span class='hs-varid'>p</span>
<a name="line-205"></a>
<a name="line-206"></a><a name="crossings"></a><span class='hs-comment'>-- | Compute the sum of /signed/ crossings of a path as we travel in the</span>
<a name="line-207"></a><span class='hs-comment'>--   positive x direction from a given point.</span>
<a name="line-208"></a><span class='hs-definition'>crossings</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>P2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Path</span> <span class='hs-conid'>R2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<a name="line-209"></a><span class='hs-definition'>crossings</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-varid'>sum</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>trailCrossings</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>pathTrails</span>
<a name="line-210"></a>
<a name="line-211"></a><a name="trailCrossings"></a><span class='hs-comment'>-- | Compute the sum of signed crossings of a trail starting from the</span>
<a name="line-212"></a><span class='hs-comment'>--   given point in the positive x direction.</span>
<a name="line-213"></a><span class='hs-definition'>trailCrossings</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>P2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>P2</span><span class='hs-layout'>,</span> <span class='hs-conid'>Trail</span> <span class='hs-conid'>R2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<a name="line-214"></a>
<a name="line-215"></a>  <span class='hs-comment'>-- open trails have no inside or outside, so don't contribute crossings</span>
<a name="line-216"></a><span class='hs-definition'>trailCrossings</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>isClosed</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span>
<a name="line-217"></a>
<a name="line-218"></a><span class='hs-definition'>trailCrossings</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>unp2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>start</span><span class='hs-layout'>,</span> <span class='hs-varid'>tr</span><span class='hs-layout'>)</span>
<a name="line-219"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sum</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-varid'>test</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fixTrail</span> <span class='hs-varid'>start</span> <span class='hs-varid'>tr</span>
<a name="line-220"></a>  <span class='hs-keyword'>where</span>
<a name="line-221"></a>    <span class='hs-varid'>test</span> <span class='hs-layout'>(</span><span class='hs-conid'>FLinear</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>unp2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-varid'>ay</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>unp2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-varid'>by</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-222"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>ay</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>y</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>by</span> <span class='hs-varop'>&gt;</span> <span class='hs-varid'>y</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>isLeft</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varop'>&gt;</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>=</span>  <span class='hs-num'>1</span>
<a name="line-223"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>by</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>y</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>ay</span> <span class='hs-varop'>&gt;</span> <span class='hs-varid'>y</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>isLeft</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>=</span> <span class='hs-comment'>-</span><span class='hs-num'>1</span>
<a name="line-224"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                           <span class='hs-keyglyph'>=</span>  <span class='hs-num'>0</span>
<a name="line-225"></a>
<a name="line-226"></a>    <span class='hs-varid'>test</span> <span class='hs-varid'>c</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>FCubic</span> <span class='hs-layout'>(</span><span class='hs-varid'>unp2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x1</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-varid'>x1y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-227"></a>                   <span class='hs-layout'>(</span><span class='hs-varid'>unp2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c1</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-varid'>c1y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-228"></a>                   <span class='hs-layout'>(</span><span class='hs-varid'>unp2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c2</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-varid'>c2y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-229"></a>                   <span class='hs-layout'>(</span><span class='hs-varid'>unp2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x2</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-varid'>x2y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-230"></a>           <span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-231"></a>        <span class='hs-varid'>sum</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-varid'>testT</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ts</span>
<a name="line-232"></a>      <span class='hs-keyword'>where</span> <span class='hs-varid'>ts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>filter</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-varop'>&amp;&amp;</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;=</span><span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;=</span><span class='hs-num'>1</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-233"></a>               <span class='hs-varop'>$</span> <span class='hs-varid'>cubForm</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span>  <span class='hs-varid'>x1y</span> <span class='hs-varop'>+</span> <span class='hs-num'>3</span><span class='hs-varop'>*</span><span class='hs-varid'>c1y</span> <span class='hs-comment'>-</span> <span class='hs-num'>3</span><span class='hs-varop'>*</span><span class='hs-varid'>c2y</span> <span class='hs-varop'>+</span> <span class='hs-varid'>x2y</span><span class='hs-layout'>)</span>
<a name="line-234"></a>                         <span class='hs-layout'>(</span> <span class='hs-num'>3</span><span class='hs-varop'>*</span><span class='hs-varid'>x1y</span> <span class='hs-comment'>-</span> <span class='hs-num'>6</span><span class='hs-varop'>*</span><span class='hs-varid'>c1y</span> <span class='hs-varop'>+</span> <span class='hs-num'>3</span><span class='hs-varop'>*</span><span class='hs-varid'>c2y</span><span class='hs-layout'>)</span>
<a name="line-235"></a>                         <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-num'>3</span><span class='hs-varop'>*</span><span class='hs-varid'>x1y</span> <span class='hs-varop'>+</span> <span class='hs-num'>3</span><span class='hs-varop'>*</span><span class='hs-varid'>c1y</span><span class='hs-layout'>)</span>
<a name="line-236"></a>                         <span class='hs-layout'>(</span><span class='hs-varid'>x1y</span> <span class='hs-comment'>-</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span>
<a name="line-237"></a>            <span class='hs-varid'>testT</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>unp2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>px</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`fAtParam`</span> <span class='hs-varid'>t</span>
<a name="line-238"></a>                      <span class='hs-keyword'>in</span>  <span class='hs-keyword'>if</span> <span class='hs-varid'>px</span> <span class='hs-varop'>&gt;</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>signFromDerivAt</span> <span class='hs-varid'>t</span> <span class='hs-keyword'>else</span> <span class='hs-num'>0</span>
<a name="line-239"></a>            <span class='hs-varid'>signFromDerivAt</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span>
<a name="line-240"></a>              <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>dx</span><span class='hs-layout'>,</span><span class='hs-varid'>dy</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-num'>3</span><span class='hs-varop'>*</span><span class='hs-varid'>t</span><span class='hs-varop'>*</span><span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-varop'>*^</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>)</span><span class='hs-varop'>*^</span><span class='hs-varid'>x1</span> <span class='hs-varop'>^+^</span> <span class='hs-num'>3</span><span class='hs-varop'>*^</span><span class='hs-varid'>c1</span> <span class='hs-varop'>^-^</span> <span class='hs-num'>3</span><span class='hs-varop'>*^</span><span class='hs-varid'>c2</span> <span class='hs-varop'>^+^</span> <span class='hs-varid'>x2</span><span class='hs-layout'>)</span>
<a name="line-241"></a>                        <span class='hs-varop'>^+^</span> <span class='hs-layout'>(</span><span class='hs-num'>2</span><span class='hs-varop'>*</span><span class='hs-varid'>t</span><span class='hs-layout'>)</span>   <span class='hs-varop'>*^</span> <span class='hs-layout'>(</span><span class='hs-num'>3</span><span class='hs-varop'>*^</span><span class='hs-varid'>x1</span> <span class='hs-varop'>^-^</span> <span class='hs-num'>6</span><span class='hs-varop'>*^</span><span class='hs-varid'>c1</span> <span class='hs-varop'>^+^</span> <span class='hs-num'>3</span><span class='hs-varop'>*^</span><span class='hs-varid'>c2</span><span class='hs-layout'>)</span>
<a name="line-242"></a>                        <span class='hs-varop'>^+^</span>            <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-num'>3</span><span class='hs-layout'>)</span><span class='hs-varop'>*^</span><span class='hs-varid'>x1</span> <span class='hs-varop'>^+^</span> <span class='hs-num'>3</span><span class='hs-varop'>*^</span><span class='hs-varid'>c1</span><span class='hs-layout'>)</span>
<a name="line-243"></a>                  <span class='hs-varid'>ang</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>atan2</span> <span class='hs-varid'>dy</span> <span class='hs-varid'>dx</span>
<a name="line-244"></a>              <span class='hs-keyword'>in</span>  <span class='hs-keyword'>case</span> <span class='hs-conid'>()</span> <span class='hs-keyword'>of</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>|</span> <span class='hs-num'>0</span>      <span class='hs-varop'>&lt;</span> <span class='hs-varid'>ang</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>ang</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>tau</span><span class='hs-varop'>/</span><span class='hs-num'>2</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>-&gt;</span>  <span class='hs-num'>1</span>
<a name="line-245"></a>                               <span class='hs-keyglyph'>|</span> <span class='hs-comment'>-</span><span class='hs-varid'>tau</span><span class='hs-varop'>/</span><span class='hs-num'>2</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>ang</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>ang</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>0</span>     <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&gt;</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-comment'>-</span><span class='hs-num'>1</span>
<a name="line-246"></a>                               <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                            <span class='hs-keyglyph'>-&gt;</span>  <span class='hs-num'>0</span>
<a name="line-247"></a>
<a name="line-248"></a>    <span class='hs-varid'>isLeft</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cross</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-varop'>.-.</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>p</span> <span class='hs-varop'>.-.</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-249"></a>
<a name="line-250"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-251"></a><span class='hs-comment'>--  Clipping  ----------------------------------------------</span>
<a name="line-252"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-253"></a>
<a name="line-254"></a><a name="Clip"></a><span class='hs-comment'>-- | @Clip@ tracks the accumulated clipping paths applied to a</span>
<a name="line-255"></a><a name="Clip"></a><span class='hs-comment'>--   diagram.  Note that the semigroup structure on @Clip@ is list</span>
<a name="line-256"></a><a name="Clip"></a><span class='hs-comment'>--   concatenation, so applying multiple clipping paths is sensible.</span>
<a name="line-257"></a><a name="Clip"></a><span class='hs-comment'>--   The clipping region is the intersection of all the applied</span>
<a name="line-258"></a><a name="Clip"></a><span class='hs-comment'>--   clipping paths.</span>
<a name="line-259"></a><a name="Clip"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>Clip</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Clip</span> <span class='hs-layout'>{</span> <span class='hs-varid'>getClip</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Path</span> <span class='hs-conid'>R2</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>}</span>
<a name="line-260"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Typeable</span><span class='hs-layout'>,</span> <span class='hs-conid'>Semigroup</span><span class='hs-layout'>)</span>
<a name="line-261"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>AttributeClass</span> <span class='hs-conid'>Clip</span>
<a name="line-262"></a>
<a name="line-263"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>V</span> <span class='hs-conid'>Clip</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>R2</span>
<a name="line-264"></a>
<a name="line-265"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Transformable</span> <span class='hs-conid'>Clip</span> <span class='hs-keyword'>where</span>
<a name="line-266"></a>  <span class='hs-varid'>transform</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Clip</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Clip</span> <span class='hs-layout'>(</span><span class='hs-varid'>transform</span> <span class='hs-varid'>t</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span>
<a name="line-267"></a>
<a name="line-268"></a><a name="clipBy"></a><span class='hs-comment'>-- | Clip a diagram by the given path:</span>
<a name="line-269"></a><span class='hs-comment'>--</span>
<a name="line-270"></a><span class='hs-comment'>--   * Only the parts of the diagram which lie in the interior of the</span>
<a name="line-271"></a><span class='hs-comment'>--     path will be drawn.</span>
<a name="line-272"></a><span class='hs-comment'>--</span>
<a name="line-273"></a><span class='hs-comment'>--   * The envelope of the diagram is unaffected.</span>
<a name="line-274"></a><span class='hs-definition'>clipBy</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>HasStyle</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>V</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>R2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Path</span> <span class='hs-conid'>R2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-275"></a><span class='hs-definition'>clipBy</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>applyTAttr</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Clip</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-276"></a>
<a name="line-277"></a><span class='hs-comment'>-- XXX Should include a 'clipTo' function which clips a diagram AND</span>
<a name="line-278"></a><span class='hs-comment'>-- restricts its envelope.  It will have to take a *pointwise minimum*</span>
<a name="line-279"></a><span class='hs-comment'>-- of the diagram's current envelope and the path's envelope.  Not</span>
<a name="line-280"></a><span class='hs-comment'>-- sure of the best way to do this at the moment.</span>
</pre></body>
</html>
